const carMarket = {
    sellers: [
        {
            agencyName: "Best Deal",
            cash: 1245000,
            credit: 200000,
            agencyId: "Plyq5M5AZ",

            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "3",
                            year: 2015,
                            price: 137000,
                            carNumber: "AZJZ4",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "X6",
                            year: 2020,
                            price: 966500,
                            carNumber: "S6DL1",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Land Cruiser",
                            year: 2020,
                            price: 336300,
                            carNumber: "6rvXw",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Hilux",
                            year: 2005,
                            price: 35005,
                            carNumber: "MWXBG",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Corolla",
                            year: 2020,
                            price: 111900,
                            carNumber: "hCzl-",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
                {
                    brand: "Ford",
                    models: [
                        {
                            name: "Focus",
                            year: 2020,
                            price: 98200,
                            carNumber: "kN3HP",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Focus",
                            year: 2005,
                            price: 6502,
                            carNumber: "LJTCs",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
                {
                    brand: "Alpha romeo",
                    models: [
                        {
                            name: "Romeo Julia",
                            year: 2020,
                            price: 275406,
                            carNumber: "2kjy7",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Romeo Stelvio",
                            year: 2019,
                            price: 215403,
                            carNumber: "7A5b-",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
                {
                    brand: "Chevrolet",
                    models: [
                        {
                            name: "Traverse",
                            year: 2020,
                            price: 201102,
                            carNumber: "QwBOT",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Impala",
                            year: 2019,
                            price: 165041,
                            carNumber: "2v4jt",
                            ownerId: "Plyq5M5AZ",
                        },
                        {
                            name: "Malibu",
                            year: 2017,
                            price: 75405,
                            carNumber: "O4_Jv",
                            ownerId: "Plyq5M5AZ",
                        },
                    ],
                },
            ],
        },
        {
            agencyName: "CarMax",
            cash: 968541,
            credit: 500000,
            agencyId: "26_IPfHU1",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "X5",
                            year: 2015,
                            price: 218000,
                            carNumber: "4Ixb0",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "X6",
                            year: 2014,
                            price: 97100,
                            carNumber: "kAnv-",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Z4",
                            year: 2019,
                            price: 296900,
                            carNumber: "ISMdU",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "3",
                            year: 2010,
                            price: 75100,
                            carNumber: "9DJPw",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Land Cruiser",
                            year: 2005,
                            price: 80540,
                            carNumber: "Kt-pW",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Corolla",
                            year: 2019,
                            price: 109100,
                            carNumber: "YiYdI",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Hilux",
                            year: 2019,
                            price: 204000,
                            carNumber: "DRmNw",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
                {
                    brand: "Ford",
                    models: [
                        {
                            name: "F250",
                            year: 2020,
                            price: 198500,
                            carNumber: "g4Wfp",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Explorer",
                            year: 2020,
                            price: 265200,
                            carNumber: "iNT8Q",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
                {
                    brand: "Alpha romeo",
                    models: [
                        {
                            name: "Spider",
                            year: 2011,
                            price: 75405,
                            carNumber: "6t7QU",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "166",
                            year: 2002,
                            price: 12400,
                            carNumber: "XMqpn",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
                {
                    brand: "Chevrolet",
                    models: [
                        {
                            name: "Impala",
                            year: 2016,
                            price: 65042,
                            carNumber: "vbeAo",
                            ownerId: "26_IPfHU1",
                        },
                        {
                            name: "Savannah",
                            year: 2016,
                            price: 76505,
                            carNumber: "WelWa",
                            ownerId: "26_IPfHU1",
                        },
                    ],
                },
            ],
        },
        {
            agencyName: "The Auto World",
            cash: 687450,
            credit: 200000,
            agencyId: "gNHjNFL12",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "X6",
                            year: 2018,
                            price: 548100,
                            carNumber: "EMW_7",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "3",
                            year: 2017,
                            price: 178000,
                            carNumber: "XlnB4",
                            ownerId: "gNHjNFL12",
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Prius",
                            year: 2017,
                            price: 101542,
                            carNumber: "-RQgN",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "Highlander",
                            year: 2017,
                            price: 202540,
                            carNumber: "AZJZ4",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "Corolla",
                            year: 1996,
                            price: 5420,
                            carNumber: "kHE8f",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "Corolla",
                            year: 2012,
                            price: 40570,
                            carNumber: "p2qEi",
                            ownerId: "gNHjNFL12",
                        },
                    ],
                },
                {
                    brand: "Ford",
                    models: [
                        {
                            name: "Explorer",
                            year: 2014,
                            price: 127502,
                            carNumber: "Ty1zN",
                            ownerId: "gNHjNFL12",
                        },
                        {
                            name: "F350",
                            year: 2012,
                            price: 54250,
                            carNumber: "z03H2",
                            ownerId: "gNHjNFL12",
                        },
                    ],
                },
                {
                    brand: "Chevrolet",
                    models: [
                        {
                            name: "Savannah",
                            year: 2010,
                            price: 36504,
                            carNumber: "RXFZe",
                            ownerId: "gNHjNFL12",
                            isavailable:true
                        },
                        {
                            name: "Malibu",
                            year: 2009,
                            price: 19585,
                            carNumber: "K5IsM",
                            ownerId: "gNHjNFL12",
                            isavailable:false
                        },
                    ],
                },
            ],
        },
        {
            agencyName: "Car Werks",
            cash: 302502,
            credit: 150000,
            agencyId: "9KeaYbRLP",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "8",
                            year: 2020,
                            price: 942500,
                            carNumber: "4IUMz",
                            ownerId: "9KeaYbRLP",
                            isavailable:true
                        },
                        {
                            name: "X6",
                            year: 2010,
                            price: 129000,
                            carNumber: "Vw0fV",
                            ownerId: "9KeaYbRLP",
                            isavailable:true
                        },
                        {
                            name: "X3",
                            year: 2019,
                            price: 358100,
                            carNumber: "ufN54",
                            ownerId: "9KeaYbRLP",
                            isavailable:true
                        },
                        {
                            name: "3",
                            year: 2020,
                            price: 389100,
                            carNumber: "F127X",
                            ownerId: "9KeaYbRLP",
                            isavailable:false
                        },
                        {
                            name: "3",
                            year: 2002,
                            price: 18400,
                            carNumber: "ueZUp",
                            ownerId: "9KeaYbRLP",
                            isavailable:true
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Prius",
                            year: 2011,
                            price: 38520,
                            carNumber: "AZJZ4",
                            ownerId: "9KeaYbRLP",
                            isavailable:true
                        },
                        {
                            name: "Land Cruiser",
                            year: 2019,
                            price: 290040,
                            carNumber: "AZJZ4",
                            ownerId: "9KeaYbRLP",
                            isavailable:true
                        },
                        {
                            name: "Hilux",
                            year: 2020,
                            price: 215700,
                            carNumber: "xig8N",
                            ownerId: "9KeaYbRLP",
                            isavailable:false
                        },
                        {
                            name: "Hilux",
                            year: 2015,
                            price: 178506,
                            carNumber: "ghTiQ",
                            ownerId: "9KeaYbRLP",
                            isavailable:false
                        },
                        {
                            name: "Corolla",
                            year: 2002,
                            price: 8504,
                            carNumber: "Mvw8T",
                            ownerId: "9KeaYbRLP",
                            isavailable:true
                        },
                    ],
                },
                {
                    brand: "Chevrolet",
                    models: [
                        {
                            name: "Impala",
                            year: 2005,
                            price: 9320,
                            carNumber: "BZpkt",
                            ownerId: "9KeaYbRLP",
                            isavailable:true 
                        },
                        {
                            name: "Malibu",
                            year: 2002,
                            price: 4502,
                            carNumber: "KqKV_",
                            ownerId: "9KeaYbRLP",
                            isavailable:false
                        },
                    ],
                },
            ],
        },
        {
            agencyName: "Carsova",
            cash: 72450,
            credit: 50000,
            agencyId: "oqQmsZoUo",
            cars: [
                {
                    brand: "bmw",
                    models: [
                        {
                            name: "7",
                            year: 1999,
                            price: 24700,
                            carNumber: "sZrjp",
                            ownerId: "oqQmsZoUo",
                            isavailable:true
                        },
                        {
                            name: "3",
                            year: 2008,
                            price: 54000,
                            carNumber: "da88K",
                            ownerId: "oqQmsZoUo",
                            isavailable:true
                        },
                    ],
                },
                {
                    brand: "toyota",
                    models: [
                        {
                            name: "Prius",
                            year: 2019,
                            price: 124050,
                            carNumber: "ZfbqH",
                            ownerId: "oqQmsZoUo",
                            isavailable:false
                        },
                        {
                            name: "Hilux",
                            year: 1996,
                            price: 11540,
                            carNumber: "AZJZ4",
                            ownerId: "oqQmsZoUo",
                            isavailable:true
                        },
                    ],
                },
            ],
        },
    ],
    customers: [
        {
            name: "Lilah Goulding",
            id: "BGzHhjnE8",
            cars: [
                {
                    name: "Corolla",
                    year: 2013,
                    price: 40570,
                    carNumber: "16da1",
                    ownerId: "BGzHhjnE8",
                },
            ],
            cash: 35000,
        },
        {
            name: "Ravi Murillo",
            id: "2RprZ1dbL",
            cars: [
                {
                    name: "M5",
                    year: 2019,
                    price: 578054,
                    carNumber: "WIh0U",
                    ownerId: "2RprZ1dbL",
                },
                {
                    name: "Spider",
                    year: 2012,
                    price: 81520,
                    carNumber: "RLS4q",
                    ownerId: "2RprZ1dbL",
                },
            ],
            cash: 278542,
        },
        {
            name: "Aleksander Carr",
            id: "pAuFtn_WA",
            cars: [
                {
                    name: "Highlander",
                    year: 2018,
                    price: 214503,
                    carNumber: "2WU_y",
                    ownerId: "pAuFtn_WA",
                },
            ],
            cash: 125402,
        },
        {
            name: "Lana Edge",
            id: "cnTobUDy6",
            cars: [
                {
                    name: "F250",
                    year: 2020,
                    price: 198500,
                    carNumber: "Xxcy_",
                    ownerId: "cnTobUDy6",
                },
                {
                    name: "Hilux",
                    year: 2005,
                    price: 35005,
                    carNumber: "VSCUj",
                    ownerId: "cnTobUDy6",
                },
            ],
            cash: 7000,
        },
        {
            name: "Nikita Philip",
            id: "5x2tMcX4R",
            cars: [
                {
                    name: "Impala",
                    year: 2016,
                    price: 65042,
                    carNumber: "LKInp",
                    ownerId: "5x2tMcX4R",
                },
            ],
            cash: 40541,
        },
        {
            name: "Bob Steel",
            id: "Wm6BkA1F0",
            cars: [],
            cash: 15732,
        },
        {
            name: "Will Reyes",
            id: "FQvNsEwLZ",
            cars: [
                { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
                {
                    name: "Land Cruiser",
                    year: 2020,
                    price: 336300,
                    carNumber: "vaJvd",
                    ownerId: "FQvNsEwLZ",
                },
                {
                    name: "Romeo Julia",
                    year: 2020,
                    price: 275406,
                    carNumber: "qLoYR",
                    ownerId: "FQvNsEwLZ",
                },
                {
                    name: "Explorer",
                    year: 2020,
                    price: 265200,
                    carNumber: "tlGRq",
                    ownerId: "FQvNsEwLZ",
                },
            ],
            cash: 1547242,
        },
    ],
    taxesAuthority: {
        totalTaxesPaid: 0,
        sumOfAllTransactions: 0,
        numberOfTransactions: 0,
    },
    search_Agency: function (agency) {
        const searched_agency = this.sellers.find((ele) => ele.agencyName.toLowerCase() == agency.toLowerCase() || ele.agencyId.toLowerCase() == agency.toLowerCase());
        if (searched_agency) {
            return searched_agency;

        } else {
            console.error("No such Agency");
        }

    },
    search_car: function (AgencyName, carBrand) {
        const found = this.search_Agency(AgencyName);
        const searched_car = found.cars.find((ele) => ele.brand.toLowerCase() == carBrand.toLowerCase());
        if (searched_car) {
            console.log('found car:', searched_car);

        } else {
            console.error('no such Car');
        }
        return searched_car;
    },
    Add_NewCar(AgencyName, NewCar) {
        const found = this.search_Agency(AgencyName);
        if (found) {
            found.cars.push(NewCar);
        } else {
            console.warn(`There is no agency named ${AgencyName}`);
        }
    },
    All_agencies_name() {
        return this.sellers.map((ele) => ele.agencyName);
    },
    Remove_car(AgencyName, carBrand, carModel) {
        const found = this.search_Agency(AgencyName);
        if (found) {
            // Find the car by brand
            const car = found.cars.find((ele) => ele.brand.toLowerCase() === carBrand.toLowerCase());
            if (car) {
                // Find the model within the car's models
                const modelIndex = car.models.findIndex((ele) => ele.name.toLowerCase() === carModel.toLowerCase());
                if (modelIndex > -1) {
                    // Remove the model from the car's models
                    car.models.splice(modelIndex, 1);
                    console.log(`Removed ${carBrand} ${carModel} from ${AgencyName}'s inventory.`);
                } else {
                    console.log(`${carModel} not in the list of car models for ${carBrand} in ${AgencyName}'s inventory.`);
                }
            } else {
                console.log(`${AgencyName} does not have a car with brand: ${carBrand}`);
            }
        } else {
            console.log(`There is no agency named ${AgencyName}`);
        }

    },
    Update_Cash(AgencyName, newCash) {
        const found = this.search_Agency(AgencyName);
        if (found) {
            found.cash = newCash;
        } else {
            console.log("there is no Agency");
        }

    },
    Update_Credit(AgencyName, newCredit) {
        const found = this.search_Agency(AgencyName);
        if (found) {
            found.credit = newCredit;
        } else {
            console.log("there is no Agency");
        }

    },
    updateCarPrice(AgencyName, carBrand, car_Model, newPrice) {
        const found = this.search_Agency(AgencyName);
        if (found) {
            const car = found.cars.find((ele) => ele.brand.toLowerCase() == carBrand.toLowerCase());
            if (car) {
                const carModel = car.models.find((ele) => ele.name == car_Model);
                if (carModel) {
                    carModel.price = newPrice;
                } else {
                    console.log(`No such model`);
                }
            } else {
                console.log('no such Car');
            }
        } else {
            console.log("there is no Agency")
        }
    },
    getTotalAgencyRevenue(AgencyName) {
        const found = this.search_Agency(AgencyName);
        if (found) {
            let totalRevenues = 0;
            found.cars.forEach((car) => {
                car.models.forEach(model => {
                    totalRevenues += model.price;
                });
            });
            console.log(`Total revenue of the ${found.agencyName} agency is: ${totalRevenues}`);
            return totalRevenues;
        } else {
            console.log("There Is No Such Agency");
        }
    },
    transferCarBetweenAgencies(SourceAgency, DestinationAgency, carBrand, carModel) {
        const source = this.search_Agency(SourceAgency);
        const destination = this.search_Agency(DestinationAgency);

        if (!source || !destination) {
            console.log("One or both agencies do not exist!");
            return;
        }

        const sourceCarBrand = source.cars.find((ele) => ele.brand.toLowerCase() === carBrand.toLowerCase());

        if (!sourceCarBrand) {
            console.log(`${carBrand} does not exist in the source agency (${SourceAgency}).`);
            return;
        }

        const sourceCarModel = sourceCarBrand.models.find((ele) => ele.name.toLowerCase() === carModel.toLowerCase());

        if (!sourceCarModel) {
            console.log(`${carModel} does not exist in ${carBrand} in the source agency (${SourceAgency}).`);
            return;
        }

        // Remove the car from the source agency
        const sourceModelIndex = sourceCarBrand.models.indexOf(sourceCarModel);
        sourceCarBrand.models.splice(sourceModelIndex, 1);

        // Add the car to the destination agency
        const destinationCarBrand = destination.cars.find((ele) => ele.brand.toLowerCase() === carBrand.toLowerCase());

        if (!destinationCarBrand) {
            // If the destination agency doesn't have this car brand, create it.
            destination.cars.push({
                brand: carBrand,
                models: [sourceCarModel],
            });
        } else {
            // If the destination agency already has this car brand, add the model.
            destinationCarBrand.models.push(sourceCarModel);
        }

        // Update cash balances
        const price = sourceCarModel.price;
        source.cash -= price;
        destination.cash += price;

        console.log(`${carBrand} ${carModel} has been transferred from ${SourceAgency} to ${DestinationAgency}!`);
    },
    search_customer(customer) {
        const searched_customer = this.customers.find((ele) => ele.name.toLowerCase() == customer.toLowerCase() || ele.id.toLowerCase() == customer.toLowerCase());
        if (searched_customer) {
            console.log(searched_customer);
            return searched_customer;
        } else {
            console.log("No such element");
        }
    },
    customers_names() {
        return this.customers.map((ele) => ele.name);
    },
    customer_cashChange(customer, newCash) {
        const searched_customer = this.search_customer(customer);
        if (searched_customer) {
            searched_customer.cash = newCash;
        } else {
            console.log('no such customer');
        }
    },
    getCustomerTotalCarValue(customer) {
        const searchedCustomer = this.search_customer(customer);
        if (searchedCustomer) {
            const totalValue = searchedCustomer.cars.reduce((acc, curr) => {
                return acc + curr.price;
            }, 0);
            console.log(`Total car value for ${searchedCustomer.name}: $${totalValue}`);
            return totalValue;
        } else {
            console.log('No such customer');
        }
    },
    Available_Cars() {
        const AvailableCars = [];
        for (const agency of this.sellers) {
            for (const car of agency.cars) {
                for (const model of car.models) {
                    if (model.isavailable) {
                        AvailableCars.push(
                            {
                                agency: agency.agencyName,
                                brand: car.brand,
                                model: model.name,
                                year: model.year,
                                price: model.price,
                            }
                        );
                    }

                }

            }

        }
        return AvailableCars;
    },
    getMostExpensiveCar() {
        let mostExpensiveCar = null;
        let highestPrice = 0;
    
        for (const agency of this.sellers) {
            for (const car of agency.cars) {
                for (const model of car.models) {
                    if (model.isavailable && model.price > highestPrice) {
                        highestPrice = model.price;
                        mostExpensiveCar = {
                            agency: agency.agencyName,
                            brand: car.brand,
                            model: model.name,
                            year: model.year,
                            price: model.price,
                        };
                    }
                }
            }
        }
    
        return mostExpensiveCar;
    },
    getCheapestCar() {
        let cheapestCar = null;
        let lowestPrice = Number.MAX_VALUE;
    
        for (const agency of this.sellers) {
            for (const car of agency.cars) {
                for (const model of car.models) {
                    if (model.isavailable && model.price < lowestPrice) {
                        lowestPrice = model.price;
                        cheapestCar = {
                            agency: agency.agencyName,
                            brand: car.brand,
                            model: model.name,
                            year: model.year,
                            price: model.price,
                        };
                    }
                }
            }
        }
    
        return cheapestCar;
    }

};
carMarket.search_Agency('Plyq5M5AZ');
carMarket.search_car('Plyq5M5AZ', 'bmw');
const newCar = {
    brand: "Tesla",
    models: [
        {
            name: "Model 3",
            year: 2022,
            price: 50000,
            carNumber: "TESLA123",
            ownerId: "ABC123",
        },
    ],
};
carMarket.Add_NewCar('Plyq5M5AZ', newCar);
carMarket.search_car('Plyq5M5AZ', 'tesla');
console.table(carMarket.All_agencies_name())
carMarket.Remove_car('Plyq5M5AZ', 'tesla', 'Model 3');
carMarket.updateCarPrice('Plyq5M5AZ', 'bmw', '3', 137);
carMarket.search_car('Plyq5M5AZ', 'bmw');
carMarket.getTotalAgencyRevenue('Plyq5M5AZ');
carMarket.transferCarBetweenAgencies('Best Deal', 'Car Werks', 'bmw', 'x6');
carMarket.search_car('Car Werks', 'bmw');
console.table(carMarket.customers_names());
carMarket.customer_cashChange('Ravi Murillo', 1000);
carMarket.getCustomerTotalCarValue('Ravi Murillo');
// carMarket.search_customer('Ravi Murillo');
console.log(carMarket.Available_Cars());
console.log("the most expensive car is:\n");
console.log(carMarket.getMostExpensiveCar());


